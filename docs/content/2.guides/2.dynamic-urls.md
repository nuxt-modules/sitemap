---
title: Dynamic URL Endpoints
description: Use runtime API endpoints to generate dynamic URLs for your sitemap.
---

## Introduction

When working with a CMS or external data sources, you may need to generate sitemap URLs dynamically at runtime.

The module supports two types of data sources:
- JSON responses from API endpoints
- XML sitemaps from external sources

## URL Structure Reference

All sitemap URLs must follow a specific structure. Whether you're creating a JSON endpoint or using the `urls` function, your URLs should match this format:

```ts
interface SitemapUrl {
  loc: string              // Required: The URL path (e.g., '/blog/my-post')
  lastmod?: string | Date  // Optional: Last modified date (ISO 8601 format or Date object)
  changefreq?: 'always' | 'hourly' | 'daily' | 'weekly' | 'monthly' | 'yearly' | 'never'
  priority?: number        // Optional: 0.0 to 1.0 (default: 0.5)
  images?: ImageEntry[]    // Optional: Array of image objects
  videos?: VideoEntry[]    // Optional: Array of video objects
  _sitemap?: string        // Optional: Specify which sitemap this URL belongs to (for multi-sitemap setups)
  alternatives?: Array<{   // Optional: For i18n/alternate language URLs
    hreflang: string       // Language code (e.g., 'en', 'fr', 'es')
    href: string           // Full URL to alternative version
  }>
}
```

**Example JSON Response:**

```json
[
  {
    "loc": "/blog/getting-started",
    "lastmod": "2024-01-15T10:30:00Z",
    "changefreq": "weekly",
    "priority": 0.8
  },
  {
    "loc": "/products/widget",
    "lastmod": "2024-01-20",
    "changefreq": "daily",
    "priority": 0.9,
    "images": [
      {
        "loc": "https://example.com/images/widget.jpg",
        "title": "Widget Product Image"
      }
    ]
  }
]
```

**Minimal Example:**

```json
[
  "/blog/post-1",
  "/blog/post-2",
  "/about"
]
```

## Using External XML Sitemaps

If you have an existing XML sitemap, you can reference it directly in your configuration:

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  sitemap: {
    sources: [
      'https://example.com/sitemap.xml',
    ]
  }
})
```

## Dynamic URLs from External APIs

When fetching dynamic URLs from external APIs, you have two main approaches:

1. **Direct source configuration** - Use when the API returns data in the correct format
2. **Custom API endpoint** - Use when you need to transform data or implement caching

### 1. Using Source Configuration

For APIs that require authentication or custom headers, provide sources as an array with fetch options:

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  sitemap: {
    sources: [
      // Unauthenticated endpoint
      'https://api.example.com/pages/urls',
      // Authenticated endpoint
      [
        'https://authenticated-api.example.com/pages/urls',
        { headers: { Authorization: 'Bearer <token>' } }
      ]
    ]
  }
})
```

### 2. Creating Custom Endpoints

**Step 1: Create the API endpoint**

Use the `defineSitemapEventHandler` helper to create type-safe sitemap endpoints:

::code-group

```ts [Simple]
// server/api/__sitemap__/urls.ts
import { defineSitemapEventHandler } from '#imports'
import type { SitemapUrlInput } from '#sitemap/types'

export default defineSitemapEventHandler(() => {
  return [
    {
      loc: '/about-us',
      // Specify which sitemap this URL belongs to
      _sitemap: 'pages',
    },
  ] satisfies SitemapUrlInput[]
})
```

```ts [Multiple Sitemaps]
// server/api/__sitemap__/urls.ts
import { defineSitemapEventHandler } from '#imports'
import type { SitemapUrl } from '#sitemap/types'

export default defineSitemapEventHandler(async () => {
  const [posts, pages] = await Promise.all([
    $fetch<{ path: string, slug: string }[]>('https://api.example.com/posts')
      .then(posts => posts.map(p => ({
        loc: `/blog/${p.slug}`, // Transform to your domain structure
        _sitemap: 'posts',
      } satisfies SitemapUrl))),
    $fetch<{ path: string }[]>('https://api.example.com/pages')
      .then(pages => pages.map(p => ({
        loc: p.path,
        _sitemap: 'pages',
      } satisfies SitemapUrl))),
  ])
  return [...posts, ...pages]
})
```

```ts [WordPress Example]
// server/api/__sitemap__/wordpress.ts
import { defineSitemapEventHandler } from '#imports'

export default defineSitemapEventHandler(async () => {
  const posts = await $fetch('https://api.externalwebsite.com/wp-json/wp/v2/posts')
  
  return posts.map(post => ({
    // Transform external URL to your domain
    loc: `/blog/${post.slug}`, // NOT post.link
    lastmod: post.modified,
    changefreq: 'weekly',
    priority: 0.7,
  }))
})
```

```ts [Dynamic i18n]
// server/api/__sitemap__/urls.ts
import { defineSitemapEventHandler } from '#imports'
import type { SitemapUrl } from '#sitemap/types'

export default defineSitemapEventHandler(async () => {
  const config = useRuntimeConfig()
  const baseUrl = config.public.siteUrl
  const locales = config.public.i18n.locales.map(locale => locale.code)
  const isoLocales = Object.fromEntries(
    config.public.i18n.locales.map(locale => ([locale.code, locale.iso]))
  )

  // Example: Fetch data for each locale
  const apiQueries = locales.map(locale => 
    $fetch(`${config.public.apiEndpoint}/sitemap/${locale}/products`)
  )

  const sitemaps = await Promise.all(apiQueries)
  
  return sitemaps.flat().map(entry => ({
    // explicit sitemap mapping
    _sitemap: isoLocales[entry.locale],
    loc: `${baseUrl}/${entry.locale}/product/${entry.url}`,
    alternatives: entry.alternates?.map(alt => ({
      hreflang: isoLocales[alt.locale],
      href: `${baseUrl}/${alt.locale}/product/${alt.url}`
    }))
  } satisfies SitemapUrl))
})
```

::

:::tip
Ensure you have a `server/tsconfig.json` file for proper TypeScript type support.
:::

**Step 2: Configure the endpoint**

Add your custom endpoint to the sitemap configuration:

::code-group

```ts [Single Sitemap]
export default defineNuxtConfig({
  sitemap: {
    sources: [
      '/api/__sitemap__/urls',
    ]
  }
})
```

```ts [Multiple Sitemaps]
export default defineNuxtConfig({
  sitemap: {
    sitemaps: {
      posts: {
        sources: [
          '/api/__sitemap__/urls/posts',
        ]
      },
      pages: {
        sources: [
          '/api/__sitemap__/urls/pages',
        ]
      }
    }
  }
})
```

::

## Verifying Your Dynamic URLs

After setting up dynamic URLs, it's important to verify they're working correctly. Here's how to check:

### 1. Test Your API Endpoint Directly

First, verify your API endpoint returns the correct data structure:

```bash
# Visit your endpoint in the browser or use curl
curl http://localhost:3000/api/__sitemap__/urls
```

**Expected Response:**

```json
[
  {
    "loc": "/blog/my-post",
    "lastmod": "2024-01-15T10:30:00Z",
    "changefreq": "weekly",
    "priority": 0.8
  }
]
```

If this doesn't work, check:
- The endpoint file exists at `server/api/__sitemap__/urls.ts`
- The endpoint returns an array of URL objects or strings
- There are no TypeScript or runtime errors

### 2. Check Your Sitemap XML

Once your endpoint is working, visit your sitemap to see if URLs appear:

```bash
# Single sitemap
http://localhost:3000/sitemap.xml

# Multiple sitemaps
http://localhost:3000/posts-sitemap.xml
http://localhost:3000/pages-sitemap.xml
```

**What to Look For:**

```xml
<url>
  <loc>https://example.com/blog/my-post</loc>
  <lastmod>2024-01-15T10:30:00Z</lastmod>
  <changefreq>weekly</changefreq>
  <priority>0.8</priority>
</url>
```

### 3. Use Nuxt DevTools

Open Nuxt DevTools (in development mode) and navigate to the Sitemap tab to:
- See all URLs in your sitemap
- View which sources contributed which URLs
- Debug data source issues
- Inspect URL properties

### 4. Common Issues

**URLs not appearing in sitemap:**

- Verify the `sources` array in `nuxt.config.ts` includes your endpoint
- Check that your endpoint URL path is correct (should start with `/`)
- Ensure the endpoint returns data in the correct format
- For multi-sitemap setups, verify the `_sitemap` property matches your sitemap name

**URLs appear in development but not production:**

- If using build-time `urls` function, ensure it's async and awaits data
- For runtime `sources`, verify the endpoint is accessible in production
- Check that your data source is available at build/runtime

**Wrong domain in sitemap URLs:**

- The `loc` field should be a path only (e.g., `/blog/post`), not a full URL
- Set your site URL in `nuxt.config.ts`:

```ts
export default defineNuxtConfig({
  site: {
    url: 'https://example.com'
  }
})
```

### 5. Testing in Production

Before deploying, test your sitemap generation:

```bash
# Build your site
npm run build

# Preview the production build
npm run preview

# Visit your sitemap
http://localhost:3000/sitemap.xml
```

This ensures your dynamic URLs work correctly in the production environment.
